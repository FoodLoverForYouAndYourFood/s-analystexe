<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ú–∞—Ç—á–µ—Ä —Ä–µ–∑—é–º–µ ‚Äî –°–∫—Ä–∏–Ω–µ—Ä</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; }
    .shadow-brutal { box-shadow: 4px 4px 0px 0px rgba(0,0,0,1); }
    .shadow-brutal-lg { box-shadow: 6px 6px 0px 0px rgba(0,0,0,1); }
    .shadow-brutal-sm { box-shadow: 3px 3px 0px 0px rgba(0,0,0,1); }
    .hover-press:hover { transform: translate(2px, 2px); box-shadow: none; }
    .hover-press-sm:hover { transform: translate(1px, 1px); box-shadow: none; }
  </style>
</head>
<body class="bg-[#FFFEF9] text-black">

  <!-- Navigation -->
  <nav class="py-4 px-6 md:px-12 flex justify-between items-center">
    <div class="flex items-center gap-2">
      <div class="w-10 h-10 bg-[#FCD34D] border-2 border-black rounded-xl shadow-brutal-sm flex items-center justify-center font-black text-lg">
        –°
      </div>
      <span class="font-bold text-xl">—Å–∫—Ä–∏–Ω–µ—Ä</span>
    </div>
    <div class="flex items-center gap-3">
      <a id="login-link" href="/cabinet.html" class="bg-white border-2 border-black rounded-xl px-4 py-2 font-semibold shadow-brutal-sm hover-press-sm transition-all">
        –í–æ–π—Ç–∏
      </a>
      <a id="cabinet-link" href="/cabinet.html" class="hidden bg-[#FCD34D] border-2 border-black rounded-xl px-4 py-2 font-semibold shadow-brutal-sm hover-press-sm transition-all">
        –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
      </a>
      <a id="admin-link" href="/cabinet.html#admin" class="hidden bg-black text-white border-2 border-black rounded-xl px-4 py-2 font-semibold shadow-brutal-sm hover-press-sm transition-all">
        –ê–¥–º–∏–Ω
      </a>
      <span id="user-badge" class="hidden border-2 border-black rounded-xl px-3 py-2 text-sm font-semibold shadow-brutal-sm"></span>
      <a href="https://s.analystexe.ru" class="bg-white border-2 border-black rounded-xl px-4 py-2 font-semibold shadow-brutal-sm hover-press-sm transition-all">
        –ù–∞ –≥–ª–∞–≤–Ω—É—é
      </a>
    </div>
  </nav>

  <!-- Hero -->
  <section class="px-6 md:px-12 py-10 md:py-16">
    <div class="max-w-4xl mx-auto text-center">
      <div class="inline-block bg-[#FCD34D] border-2 border-black rounded-full px-4 py-1 mb-6 shadow-brutal-sm font-medium text-sm">
        üß† –º–∞—Ç—á–µ—Ä —Ä–µ–∑—é–º–µ
      </div>
      <h1 class="text-4xl md:text-6xl font-black mb-6 leading-tight">
        –ø—Ä–æ–≤–µ—Ä—å –≤–∞–∫–∞–Ω—Å–∏—é<br>
        <span class="bg-[#FCD34D] px-2">–∏ —Ä–µ–∑—é–º–µ</span> –∑–∞ 1 –º–∏–Ω—É—Ç—É
      </h1>
      <p class="text-lg md:text-xl text-gray-700 mb-8 max-w-2xl mx-auto">
        AI –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, –∞–ª–≥–æ—Ä–∏—Ç–º —Å—á–∏—Ç–∞–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, –∞ –ø–æ—Ç–æ–º –æ–±—ä—è—Å–Ω—è–µ—Ç, —á—Ç–æ –ø–æ–¥—Ç—è–Ω—É—Ç—å.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="#matcher" class="bg-[#FCD34D] border-2 border-black rounded-2xl px-8 py-4 font-bold text-lg shadow-brutal hover-press transition-all">
          –ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É ‚Üí
        </a>
        <a href="#how" class="bg-white border-2 border-black rounded-2xl px-8 py-4 font-bold text-lg shadow-brutal hover-press transition-all">
          –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
        </a>
      </div>
    </div>
  </section>

  <!-- How It Works -->
  <section id="how" class="px-6 md:px-12 py-14 bg-white border-y-2 border-black">
    <div class="max-w-5xl mx-auto">
      <h2 class="text-3xl md:text-4xl font-black text-center mb-4">–∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h2>
      <p class="text-center text-gray-600 mb-12 text-lg">—Ç—Ä–∏ —à–∞–≥–∞ ‚Äî –∏ —Ç—ã –≤–∏–¥–∏—à—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ</p>

      <div class="grid md:grid-cols-3 gap-8">
        <div class="text-center">
          <div class="w-16 h-16 bg-[#FCD34D] border-2 border-black rounded-2xl shadow-brutal mx-auto mb-4 flex items-center justify-center text-2xl font-black">
            1
          </div>
          <h3 class="font-bold text-xl mb-2">–í—Å—Ç–∞–≤–ª—è–µ—à—å –≤–∞–∫–∞–Ω—Å–∏—é</h3>
          <p class="text-gray-600">–ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –Ω–∞–≤—ã–∫–∏ –≤—ã—Ç–∞—Å–∫–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
        </div>
        <div class="text-center">
          <div class="w-16 h-16 bg-[#FCD34D] border-2 border-black rounded-2xl shadow-brutal mx-auto mb-4 flex items-center justify-center text-2xl font-black">
            2
          </div>
          <h3 class="font-bold text-xl mb-2">–í—Å—Ç–∞–≤–ª—è–µ—à—å —Ä–µ–∑—é–º–µ</h3>
          <p class="text-gray-600">–ú—ã –¥–æ—Å—Ç–∞—ë–º –æ–ø—ã—Ç, hard/soft skills –∏ —Å—Ç–∞–∂.</p>
        </div>
        <div class="text-center">
          <div class="w-16 h-16 bg-[#FCD34D] border-2 border-black rounded-2xl shadow-brutal mx-auto mb-4 flex items-center justify-center text-2xl font-black">
            3
          </div>
          <h3 class="font-bold text-xl mb-2">–ü–æ–ª—É—á–∞–µ—à—å –æ—Ç—á—ë—Ç</h3>
          <p class="text-gray-600">–ê–ª–≥–æ—Ä–∏—Ç–º —Å—Ç–∞–≤–∏—Ç –æ—Ü–µ–Ω–∫—É, AI –æ–±—ä—è—Å–Ω—è–µ—Ç –∏ –¥–∞—ë—Ç —Å–æ–≤–µ—Ç—ã.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Matcher Form -->
  <section id="matcher" class="px-6 md:px-12 py-14">
    <div class="max-w-6xl mx-auto">
      <div class="text-center mb-10">
        <h2 class="text-3xl md:text-4xl font-black mb-4">–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–∏</h2>
        <p class="text-gray-600 text-lg">–≤—Å—Ç–∞–≤—å –≤–∞–∫–∞–Ω—Å–∏—é –∏ —Ä–µ–∑—é–º–µ ‚Äî –ø–æ–ª—É—á–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ</p>
      </div>

      <div class="grid lg:grid-cols-2 gap-8">
        <div class="bg-white border-2 border-black rounded-2xl p-6 shadow-brutal">
          <label class="font-bold text-lg block mb-3">–¢–µ–∫—Å—Ç –≤–∞–∫–∞–Ω—Å–∏–∏</label>
          <textarea id="vacancy-input" rows="10" class="w-full border-2 border-black rounded-xl p-4 text-sm focus:outline-none focus:ring-2 focus:ring-[#FCD34D]" placeholder="–°–∫–æ–ø–∏—Ä—É–π –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é..."></textarea>
          <p class="text-sm text-gray-600 mt-2">–õ—É—á—à–µ –≤—Å—Ç–∞–≤–ª—è—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –≤–∞–∫–∞–Ω—Å–∏–∏ (–æ—Ç 100+ —Å–∏–º–≤–æ–ª–æ–≤).</p>
        </div>

        <div class="bg-white border-2 border-black rounded-2xl p-6 shadow-brutal">
          <label class="font-bold text-lg block mb-3">–¢–µ–∫—Å—Ç —Ä–µ–∑—é–º–µ</label>
          <textarea id="resume-input" rows="10" class="w-full border-2 border-black rounded-xl p-4 text-sm focus:outline-none focus:ring-2 focus:ring-[#FCD34D]" placeholder="–í—Å—Ç–∞–≤—å —Ä–µ–∑—é–º–µ: –æ–ø—ã—Ç, —Å—Ç–µ–∫, –ø—Ä–æ–µ–∫—Ç—ã..."></textarea>
          <p class="text-sm text-gray-600 mt-2">–ú–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –∏–∑ PDF/DOCX.</p>
        </div>
      </div>

      <div class="grid lg:grid-cols-3 gap-6 mt-8">
        <div class="bg-white border-2 border-black rounded-2xl p-6 shadow-brutal">
          <div class="font-bold text-lg mb-3">–§–æ—Ä–º–∞—Ç —Ä–∞–±–æ—Ç—ã</div>
          <div class="space-y-2 text-sm">
            <label class="flex items-center gap-2">
              <input type="checkbox" id="format-remote" class="accent-black">
              <span>–£–¥–∞–ª—ë–Ω–∫–∞</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="format-hybrid" class="accent-black">
              <span>–ì–∏–±—Ä–∏–¥</span>
            </label>
            <label class="flex items-center gap-2">
              <input type="checkbox" id="format-office" class="accent-black">
              <span>–û—Ñ–∏—Å</span>
            </label>
          </div>
        </div>

        <div class="bg-white border-2 border-black rounded-2xl p-6 shadow-brutal">
          <label class="font-bold text-lg block mb-3">–ñ–µ–ª–∞–µ–º–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞</label>
          <input id="salary-min" class="w-full border-2 border-black rounded-xl p-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#FCD34D]" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 200000">
          <p class="text-sm text-gray-600 mt-2">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –µ—Å—Ç—å –ø–æ—Ä–æ–≥.</p>
        </div>

        <div class="bg-white border-2 border-black rounded-2xl p-6 shadow-brutal">
          <label class="font-bold text-lg block mb-3">–¢–≤–æ–∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏</label>
          <input id="red-flags" class="w-full border-2 border-black rounded-xl p-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#FCD34D] mb-3" placeholder="red flags, —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é">
          <input id="must-have" class="w-full border-2 border-black rounded-xl p-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#FCD34D]" placeholder="must have, —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é">
        </div>
      </div>

      <div class="flex flex-col items-center gap-4 mt-8">
        <div id="error-msg" class="hidden bg-[#FEE2E2] border-2 border-black rounded-xl px-4 py-3 text-sm font-semibold shadow-brutal-sm"></div>
        <button id="analyze-btn" class="bg-black text-white border-2 border-black rounded-2xl px-10 py-4 font-bold text-lg shadow-brutal hover-press transition-all">
          –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ ‚Üí
        </button>
        <div id="loading-msg" class="hidden text-sm text-gray-600">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º‚Ä¶</div>
      </div>
    </div>
  </section>

  <!-- Results -->
  <section id="results-section" class="px-6 md:px-12 py-14 hidden">
    <div class="max-w-6xl mx-auto">
      <div class="bg-white border-2 border-black rounded-2xl p-6 shadow-brutal-lg mb-8">
        <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
          <div>
            <div class="text-sm text-gray-500 mb-2">–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞</div>
            <div id="score-value" class="text-5xl font-black">0/10</div>
          </div>
          <div class="flex-1">
            <div id="verdict-text" class="text-lg font-semibold"></div>
          </div>
        </div>
      </div>

      <div id="company-block" class="hidden bg-white border-2 border-black rounded-2xl p-6 shadow-brutal mb-8">
        <div class="font-bold text-xl mb-2">–ö–æ–º–ø–∞–Ω–∏—è</div>
        <div id="company-info" class="text-gray-700"></div>
      </div>

      <div class="grid lg:grid-cols-2 gap-6 mb-8">
        <div class="bg-white border-2 border-black rounded-2xl p-6 shadow-brutal">
          <div class="font-bold text-xl mb-4">–ú–∞—Ç—Ä–∏—Ü–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è</div>
          <div id="matches-block" class="space-y-4"></div>
        </div>
        <div class="bg-white border-2 border-black rounded-2xl p-6 shadow-brutal">
          <div class="font-bold text-xl mb-4">–î–µ—Ç–∞–ª–∏</div>
          <div id="details-block" class="space-y-2 text-gray-700"></div>
        </div>
      </div>

      <div id="pros-cons-block" class="grid lg:grid-cols-2 gap-6 mb-8 hidden">
        <div class="bg-white border-2 border-black rounded-2xl p-6 shadow-brutal">
          <div class="font-bold text-xl mb-4">–ü–ª—é—Å—ã</div>
          <ul id="pros-list" class="space-y-2 text-gray-700"></ul>
        </div>
        <div class="bg-white border-2 border-black rounded-2xl p-6 shadow-brutal">
          <div class="font-bold text-xl mb-4">–ú–∏–Ω—É—Å—ã</div>
          <ul id="cons-list" class="space-y-2 text-gray-700"></ul>
        </div>
      </div>

      <div id="recommendation-block" class="bg-[#FCD34D] border-2 border-black rounded-2xl p-6 shadow-brutal hidden">
        <div id="recommendation-decision" class="font-bold text-xl mb-4"></div>
        <ol id="recommendation-actions" class="space-y-2 text-gray-800"></ol>
      </div>
    </div>
  </section>

  <script>
    const analyzeBtn = document.getElementById('analyze-btn');
    const errorMsg = document.getElementById('error-msg');
    const loadingMsg = document.getElementById('loading-msg');
    const resultsSection = document.getElementById('results-section');

    const scoreValue = document.getElementById('score-value');
    const verdictText = document.getElementById('verdict-text');
    const companyBlock = document.getElementById('company-block');
    const companyInfo = document.getElementById('company-info');
    const matchesBlock = document.getElementById('matches-block');
    const detailsBlock = document.getElementById('details-block');
    const prosConsBlock = document.getElementById('pros-cons-block');
    const prosList = document.getElementById('pros-list');
    const consList = document.getElementById('cons-list');
    const recommendationBlock = document.getElementById('recommendation-block');
    const recommendationDecision = document.getElementById('recommendation-decision');
    const recommendationActions = document.getElementById('recommendation-actions');

    const getWorkFormat = () => {
      const formats = [];
      if (document.getElementById('format-remote').checked) formats.push('remote');
      if (document.getElementById('format-hybrid').checked) formats.push('hybrid');
      if (document.getElementById('format-office').checked) formats.push('office');
      return formats;
    };

    const parseList = (value) => (
      value.split(',')
        .map((item) => item.trim())
        .filter(Boolean)
    );

    const setError = (message) => {
      if (!message) {
        errorMsg.classList.add('hidden');
        return;
      }
      errorMsg.textContent = message;
      errorMsg.classList.remove('hidden');
    };

    const setLoading = (state) => {
      analyzeBtn.disabled = state;
      analyzeBtn.textContent = state ? '–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é‚Ä¶' : '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ ‚Üí';
      loadingMsg.classList.toggle('hidden', !state);
    };

    const statusStyles = {
      match: { icon: '‚úÖ', color: 'text-green-700', bg: 'bg-green-50' },
      partial: { icon: 'üü°', color: 'text-yellow-700', bg: 'bg-yellow-50' },
      gap: { icon: '‚ùå', color: 'text-red-700', bg: 'bg-red-50' }
    };

    const renderMatches = (matches) => {
      matchesBlock.innerHTML = '';
      matches.forEach((match) => {
        const style = statusStyles[match.status] || statusStyles.partial;
        const card = document.createElement('div');
        card.className = `${style.bg} border-2 border-black rounded-xl p-4`;
        card.innerHTML = `
          <div class="flex items-start gap-3">
            <span class="text-xl">${style.icon}</span>
            <div class="flex-1">
              <div class="font-bold">${match.item}</div>
              <div class="text-sm text-gray-600 mt-1">${match.comment || '‚Äî'}</div>
              <div class="text-xs ${style.color} font-semibold mt-2">${match.status.toUpperCase()}</div>
            </div>
          </div>
        `;
        matchesBlock.appendChild(card);
      });
    };

    const renderDetails = (details) => {
      detailsBlock.innerHTML = '';
      const entries = [
        { label: '–ö–∞—Ä—å–µ—Ä–Ω—ã–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã', value: details.career },
        { label: '–°—Ç–µ–∫ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', value: details.stack },
        { label: '–ö–æ–º–∞–Ω–¥–∞', value: details.team }
      ];
      entries.forEach((entry) => {
        if (!entry.value) return;
        const row = document.createElement('div');
        row.innerHTML = `<span class="font-semibold">${entry.label}:</span> ${entry.value}`;
        detailsBlock.appendChild(row);
      });
    };

    const renderProsCons = (pros, cons) => {
      prosList.innerHTML = '';
      consList.innerHTML = '';
      pros.forEach((item) => {
        const li = document.createElement('li');
        li.textContent = item;
        prosList.appendChild(li);
      });
      cons.forEach((item) => {
        const li = document.createElement('li');
        li.textContent = item;
        consList.appendChild(li);
      });
    };

    const renderRecommendation = (recommendation) => {
      recommendationDecision.textContent = recommendation.decision || '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è';
      recommendationActions.innerHTML = '';
      (recommendation.actions || []).forEach((action, index) => {
        const li = document.createElement('li');
        li.className = 'flex items-center gap-3';
        li.innerHTML = `
          <span class="w-6 h-6 bg-black text-white rounded-full flex items-center justify-center text-sm font-bold">${index + 1}</span>
          <span>${action}</span>
        `;
        recommendationActions.appendChild(li);
      });
    };

    const getCookie = (name) => {
      const match = document.cookie.match(new RegExp(`(?:^|; )${name}=([^;]*)`));
      return match ? decodeURIComponent(match[1]) : '';
    };

    const getToken = () => {
      const stored = localStorage.getItem('screener_session_token');
      if (stored) return stored;
      const cookieToken = getCookie('screener_session');
      if (cookieToken) {
        localStorage.setItem('screener_session_token', cookieToken);
        return cookieToken;
      }
      return '';
    };

    const ensureCookie = (token) => {
      if (!token) return;
      const secure = window.location.protocol === 'https:' ? '; Secure' : '';
      document.cookie = `screener_session=${token}; Path=/; Max-Age=86400; SameSite=Lax${secure}`;
    };

    const updateAuthUI = (user, isAdmin) => {
      const loginLink = document.getElementById('login-link');
      const cabinetLink = document.getElementById('cabinet-link');
      const adminLink = document.getElementById('admin-link');
      const userBadge = document.getElementById('user-badge');
      if (!user) {
        loginLink.classList.remove('hidden');
        cabinetLink.classList.add('hidden');
        adminLink.classList.add('hidden');
        userBadge.classList.add('hidden');
        return;
      }
      loginLink.classList.add('hidden');
      cabinetLink.classList.remove('hidden');
      userBadge.textContent = `@${user.username || user.first_name || 'user'}`;
      userBadge.classList.remove('hidden');
      if (isAdmin) {
        adminLink.classList.remove('hidden');
      } else {
        adminLink.classList.add('hidden');
      }
    };

    const bootAuth = async () => {
      const token = getToken();
      if (!token) {
        updateAuthUI(null, false);
        return;
      }
      ensureCookie(token);
      try {
        const resp = await fetch('/api/me', {
          headers: { Authorization: `Bearer ${token}` },
          credentials: 'same-origin'
        });
        if (!resp.ok) {
          localStorage.removeItem('screener_session_token');
          updateAuthUI(null, false);
          return;
        }
        const data = await resp.json();
        if (!data.ok) {
          updateAuthUI(null, false);
          return;
        }
        updateAuthUI(data.user, data.is_admin);
      } catch (e) {
        updateAuthUI(null, false);
      }
    };

    analyzeBtn.addEventListener('click', async () => {
      const vacancy = document.getElementById('vacancy-input').value.trim();
      const resume = document.getElementById('resume-input').value.trim();

      if (!vacancy || !resume) {
        setError('–ó–∞–ø–æ–ª–Ω–∏ –æ–±–∞ –ø–æ–ª—è ‚Äî –≤–∞–∫–∞–Ω—Å–∏—é –∏ —Ä–µ–∑—é–º–µ.');
        return;
      }
      if (vacancy.length < 100 || resume.length < 100) {
        setError('–¢–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π. –í—Å—Ç–∞–≤—å –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ —Ä–µ–∑—é–º–µ.');
        return;
      }

      setError('');
      setLoading(true);

      try {
        const payload = {
          vacancy_text: vacancy,
          profile: {
            resume_text: resume,
            salary_min: document.getElementById('salary-min').value.trim(),
            work_format: getWorkFormat(),
            red_flags: parseList(document.getElementById('red-flags').value),
            must_have: parseList(document.getElementById('must-have').value)
          }
        };

        const token = getToken();
        const headers = { 'Content-Type': 'application/json' };
        if (token) headers['Authorization'] = `Bearer ${token}`;

        const response = await fetch('/api/analyze', {
          method: 'POST',
          headers,
          body: JSON.stringify(payload)
        });

        if (response.status === 401) {
          throw new Error('–ù—É–∂–µ–Ω –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram. –û—Ç–∫—Ä–æ–π ¬´–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç¬ª.');
        }
        if (!response.ok) {
          let errorText = '–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.';
          try {
            const errorJson = await response.json();
            if (errorJson?.error) errorText = errorJson.error;
          } catch (e) {
            // ignore
          }
          throw new Error(errorText);
        }

        const data = await response.json();

        scoreValue.textContent = `${data.score || 0}/10`;
        verdictText.textContent = data.verdict || '–ì–æ—Ç–æ–≤–æ. –°–º–æ—Ç—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.';

        if (data.company && (data.company.name || data.company.info)) {
          companyBlock.classList.remove('hidden');
          companyInfo.textContent = data.company.name
            ? `${data.company.name}. ${data.company.info || ''}`.trim()
            : data.company.info || '';
        } else {
          companyBlock.classList.add('hidden');
        }

        renderMatches(data.matches || []);

        if (data.details) {
          renderDetails(data.details);
        } else {
          detailsBlock.innerHTML = '<div class="text-gray-500">–ù–µ—Ç –¥–µ—Ç–∞–ª–µ–π</div>';
        }

        if (data.pros_cons && (data.pros_cons.pros?.length || data.pros_cons.cons?.length)) {
          prosConsBlock.classList.remove('hidden');
          renderProsCons(data.pros_cons.pros || [], data.pros_cons.cons || []);
        } else {
          prosConsBlock.classList.add('hidden');
        }

        if (data.recommendation) {
          recommendationBlock.classList.remove('hidden');
          renderRecommendation(data.recommendation);
        } else {
          recommendationBlock.classList.add('hidden');
        }

        resultsSection.classList.remove('hidden');
        resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      } catch (error) {
        setError(error.message);
      } finally {
        setLoading(false);
      }
    });

    bootAuth();
  </script>
</body>
</html>
